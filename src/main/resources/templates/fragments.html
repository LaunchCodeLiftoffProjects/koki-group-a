<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org/">

<head th:fragment="head">
  <meta charset="UTF-8">
  <title>Title</title>
</head>

<body>

<th:block th:fragment="chart-script">
  <script th:inline="javascript">

    google.charts.load('current', {'packages':['corechart']});
          google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
         timeframe = document.getElementById("thedropdown").value;

<!--Populates array with parsed bill objects-->

          const rawTypeAndAmountsObjArray = [];

          const rawBillData = [[${chartBillData}]]
          for (item in rawBillData) {
            const parsed = JSON.parse(rawBillData[item]);
            rawTypeAndAmountsObjArray.push(parsed);
          }

<!--Loops through bills and adds to new array, checks to see if type is in new array-->

          const condensedTypeAndAmountsObjArray = [];

          for (bill in rawTypeAndAmountsObjArray) {
            const type = rawTypeAndAmountsObjArray[bill].type;
            const amount = rawTypeAndAmountsObjArray[bill].amount;

            let typeExistsInArray = false;

<!--If type exists in array, add amount of current bill to existing type-->

            if (condensedTypeAndAmountsObjArray.length > 0) {
              for (let i = 0; i < condensedTypeAndAmountsObjArray.length; i++) {
                if (type === condensedTypeAndAmountsObjArray[i].type) {
                  typeExistsInArray = true;
                  condensedTypeAndAmountsObjArray[i].amount += amount;
                  break;
                }
              }
            }

            if (!typeExistsInArray) {
              condensedTypeAndAmountsObjArray.push({type: type, amount: amount});
            }
          }

          const chartData = [];
          chartData.push(['Bill', 'Dollars']);

<!--Convert object array to array of arrays-->

          condensedTypeAndAmountsObjArray.map((item, index) => {
            let innerChartData = [
              item.type, item.amount
            ];
            chartData.push(innerChartData);
          });

         info = [{time: "weekly", entertainment: 40, food: 8, commute: 4, car: 3, phone: 40},
         {time: "monthly", entertainment: 45, food: 9, commute: 3, car: 5, phone: 50}
         ];

        for(i=0; i<info.length; i++) {
        if(timeframe == info[i].time) {
           entertainment = info[i].entertainment;
           food = info[i].food;
           commute = info[i].commute;
           car = info[i].car;
           phone = info[i].phone;

        }// end if
        }// end for

        var data = google.visualization.arrayToDataTable(chartData);

            var options = {
              title: 'Spending Data',
              colors: ['orange','#00cc33', 'pink', 'yellow','lightblue'],
              is3D: true,
            };
            var chart = new google.visualization.PieChart(document.getElementById('piechart'));
            chart.draw(data, options);
          }

        // this function makes the chart responsive; include the name of the proper drawChart function; if more than one chart on page, include additional statements for each drawChart function
        window.onresize = function() {
        drawChart();
        }

    </script>
</th:block>

<!--<th:block th:fragment="chart-script">-->
<!--  <script th:inline="javascript">-->
<!--    window.onload = function() {-->

<!--var dps = [[]];-->
<!--var chart = new CanvasJS.Chart("chartContainer", {-->
<!--	exportEnabled: true,-->
<!--	animationEnabled: true,-->
<!--	theme: "light2", // "light1", "dark1", "dark2"-->
<!--	title: {-->
<!--		text: "Visitor Demographics of a Website"-->
<!--	},-->
<!--	subtitles: [{-->
<!--		text: "Age Groups of Visitors"-->
<!--	}],-->
<!--	data: [{-->
<!--		type: "pie",-->
<!--		yValueFormatString: "#,##0\"%\"",-->
<!--		indexLabel: "{label} - {y}",-->
<!--		dataPoints: dps[0]-->
<!--	}]-->
<!--});-->

<!--var yValue;-->
<!--var label;-->

<!--<c:forEach items="${dataPointsList}" var="dataPoints" varStatus="loop">-->
<!--	<c:forEach items="${dataPoints}" var="dataPoint">-->
<!--		yValue = parseFloat("${dataPoint.y}");-->
<!--		label = "${dataPoint.label}";-->
<!--		dps[parseInt("${loop.index}")].push({-->
<!--			label : label,-->
<!--			y : yValue,-->
<!--		});-->
<!--	</c:forEach>-->
<!--</c:forEach>-->

<!--chart.render();-->

<!--}-->
<!--  </script>-->
<!--</th:block>-->

<!--<th:block th:fragment="chart-script">-->
<!--  <script th:inline="javascript">-->
<!--    const chartData = [[${chartBillData}]]-->
<!--    for(item in chartData) {-->
<!--      const parsed = JSON.parse(chartData[item]);-->
<!--      console.log(parsed);-->
<!--    }-->


<!--  </script>-->
<!--</th:block>-->

</body>
</html>